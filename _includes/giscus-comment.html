{% if site.giscus.repository and site.giscus.hostname %}
<div class="giscus-comments">
  <div
    style="
      background: #f9f9f9;
      border-left: 4px solid #008aff;
      padding: 10px;
      margin-bottom: 20px;
      font-size: 0.9em;
      color: #555;
      border-radius: 0 4px 4px 0;
    "
  >
    <strong>Tip:</strong> Supports LaTeX ($x$ and $$).
    <a
      href="{{ '/math-formatting' | relative_url }}"
      target="_blank"
      style="text-decoration: underline; color: #008aff"
      >See formatting examples</a
    >.
    <br />
    To edit or delete, click the <strong>timestamp</strong> (e.g., "5 minutes
    ago") to manage on GitHub.
  </div>

  <div class="giscus" id="giscus-container"></div>

  <script
    src="https://{{ site.giscus.hostname }}/client.js"
    data-repo="{{ site.giscus.repository }}"
    data-repo-id="{{ site.giscus.repository-id }}"
    data-category="{{ site.giscus.category }}"
    data-category-id="{{ site.giscus.category-id }}"
    data-mapping="{{ site.giscus.mapping }}"
    data-reactions-enabled="{{ site.giscus.reactions-enabled }}"
    data-emit-metadata="{{ site.giscus.emit-metadata }}"
    data-input-position="bottom"
    data-theme="{{ site.giscus.theme }}"
    data-lang="en"
    crossorigin="anonymous"
    async
  ></script>

  <script>
    (function () {
      function handleDeepLink() {
        const hash = window.location.hash;
        // Check for 'discussioncomment' (no hyphen)
        if (!hash || !hash.includes("discussioncomment")) return;

        const container = document.getElementById("giscus-container");
        if (container) {
          container.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        const iframe = document.querySelector("iframe.giscus-frame");
        if (iframe) {
          try {
            const url = new URL(iframe.src);
            if (url.hash !== hash) {
              url.hash = hash;
              iframe.src = url.toString();
            }
          } catch (e) {
            console.error(e);
          }
        }
      }

      window.addEventListener("load", handleDeepLink);
      window.addEventListener("hashchange", handleDeepLink);
      window.addEventListener("message", function (event) {
        if (
          event.origin === "https://giscus.app" &&
          event.data &&
          event.data.giscus &&
          event.data.giscus.resizeHeight
        ) {
          setTimeout(handleDeepLink, 500);
        }
      });
    })();
  </script>
</div>
{% endif %}
